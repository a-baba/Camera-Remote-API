<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="/frameworks/jquery-1.11.1.min.js"></script>
    <script src="/shim/presentation_shim.js"></script>
    <script src="/shim/session_shim.js"></script>
    <style>
      #simif { display: none; }
    </style>
  </head>
  <body>
    <div id="simif"></div>
    <section id="main">
      <header>
        <h1>WoT demo</h1>
      </header>

      <section id="button">
        <button id="extern" disabled>use external camera</button>
      </section>
      <section id="contents">
        <div class="content"></div>
      </section>
    </section>

    <img id="liveview"><canvas></canvas>
  </body>
  <script>
    navigator.presentation.onavailablechange = function(){
      $("#button button")[0].disabled = false;
      console.log('@onavailablechange');
    }
    document.querySelector("button#extern").onclick = function(){
      navigator.presentation
      .startSession('urn:schemas-sony-com:service:ScalarWebAPI:1')
      .then(function(sess) {
        alert("startSession succeeded");
      });
    }
    var startLiveView = function(){
      // live view test
      var ws = new WebSocket("ws://localhost:28888");
      console.log(ws)

      ws.onopen = function(ev){
        var req = {"method": "liveview"};
        ws.send(JSON.stringify(req));
        console.log("ws://localhost:28888 send " + JSON.stringify(req))
      };

      ws.onmessage = function(mesg) {
        console.log("on message ================================================");
        console.log(mesg.data);
        var url = window.URL.createObjectURL(mesg.data);
        console.log(url);
        $("#liveview").attr("src", url);
        // todo canvasでdrawImageする
        // ref: http://html5.jp/canvas/how6.html
      };
    }


  </script>
</html>
